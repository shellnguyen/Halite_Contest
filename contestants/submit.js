!function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,s){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=9)}([function(e,t){e.exports={SERVER_DOMAIN:"ai-contest.sa2.gameloft.org"}},function(e,t){e.exports=require("child_process")},function(e,t){e.exports=require("form-data")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("jszip")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("readline")},function(e,t){e.exports=require("stream")},function(e,t){e.exports=require("util")},function(e,t,i){const s=i(3),n=i(5),r=i(6),o=i(7).Writable,a=i(2),u=i(4),c=(i(8).promisify(i(1).exec),i(0)),l={"account-new":"\nNew account was created with provided credential.","nickname-invalid":"\nYour chosen nickname is invalid, we use your email instead","password-reset":"\nAn instruction to reset password was sent to your inbox.","email-invalid":"Please use a valid Gameloft email.","email-verify":"\nTo verify your email verification, please check inbox."},p=e=>console.log(l[e]);class m{constructor(){this.stdout=new o({write:(e,t,i)=>{!this.muted&&process.stdout.write(e,t),i()}}),this.rl=r.createInterface({input:process.stdin,output:this.stdout,terminal:!0}),this.mutex=Promise.resolve()}Email(){let e=/^\S+@gameloft.com$/;return this.mutex=this.mutex.then(t=>new Promise((t,i)=>{let n=i=>{e.test(i.toLowerCase())?(this.email=i,t()):(p("email-invalid"),r())};var r=e=>this.rl.question("Email: ",n);try{let e=JSON.parse(s.readFileSync("auth.json","utf8"));n(e.email)}catch(e){r()}})),this}Password(){return this.mutex=this.mutex.then(e=>new Promise((e,t)=>{(t=>{this.muted=!1,this.rl.question("Password: ",t=>{this.muted=!1,this.password=t,e()}),this.muted=!0})()})),this}Authenticate(){return this.mutex=this.mutex.then(e=>new Promise((e,t)=>{s.writeFileSync("auth.json",JSON.stringify({email:this.email},null,"\t"));let i=new a;i.append("email",this.email.trim()),i.append("password",this.password),i.submit(`http://${c.SERVER_DOMAIN}:7001/auth`,(t,i)=>{console.log(i.statusMessage),401==i.statusCode&&process.exit(),e()})})),this}Submit(){this.mutex.then(e=>new Promise((e,t)=>{let i=new u,r=process.argv[2].replace(/\/$/,""),o=process.argv[3]||this.email.replace(/\b@.+/,""),l=e=>{let t=[];return s.readdirSync(e).forEach(i=>{let r=n.join(e,i);s.statSync(r).isFile()?t.push(r):t=t.concat(l(r))}),t};s.existsSync(n.join(r,"run.bat"))||(console.log("Submit failed!!"),process.exit()),l(r).map(e=>i.file(e.slice(r.length),s.readFileSync(e),{compression:"DEFLATE"})),i.generateAsync({type:"nodebuffer"}).then(async e=>{s.writeFileSync(r+".zip",e);let t=new a;t.append("email",this.email.trim()),t.append("nickname",o.trim()),t.append("submit",s.createReadStream(r+".zip")),t.submit(`http://${c.SERVER_DOMAIN}:7001/upload`,(e,t)=>{s.unlinkSync(r+".zip"),200==t.statusCode&&console.log("Submit successful!!"),console.log(t.statusMessage),process.exit()})})}))}}(new m).Email().Password().Authenticate().Submit()}]);